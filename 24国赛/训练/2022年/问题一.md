![image-20240814185638423](C:\Users\34999\AppData\Roaming\Typora\typora-user-images\image-20240814185638423.png)

![image-20240814185659328](C:\Users\34999\AppData\Roaming\Typora\typora-user-images\image-20240814185659328.png)

你的疑问是关于如何将非线性乘法约束转换为线性形式的问题，这也是优化问题线性化的一部分。我们先从你的问题出发，再详细解释如何通过线性化处理以及为什么公式和代码看似不同。

## 问题一

[第二章 整数规划 习题 2（司守奎数模第三版）_matlab将非线性的01规划问题转化成线性的01规划问题-CSDN博客](https://blog.csdn.net/qq_62614888/article/details/132067624?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_utm_term~default-9-132067624-blog-99593187.235^v43^pc_blog_bottom_relevance_base6&spm=1001.2101.3001.4242.6&utm_relevant_index=12)

[(24 封私信 / 80 条消息) 非线性如何线性化？ - 知乎 (zhihu.com)](https://www.zhihu.com/question/387569680)

### 问题描述与原始约束

你希望实现的约束是
$$
[
\sum_{i=1}^{420} x(i,j) \times y(i,j) < 20
]
$$


这意味着对于每一列 \( j \)，\( x(i,j) \times y(i,j) \) 的和必须小于 20。

### 非线性线性化问题

3. 在优化问题中，当你遇到非线性约束条件，比如涉及 0-1 变量 \( x \) 和连续变量 \( y \) 的乘积 \( x \times y \)，可以通过以下方法将其转化为线性约束。这样的线性化通常需要引入额外的变量或利用逻辑约束条件。
   
   ### 线性化方法
   
   假设我们有以下非线性约束：
   $$
   z = x \times y \
   $$
   
   
   
   
   其中：
   - \( x \) 是 0-1 变量，即 \( x \in \{0, 1\} \)。
   - \( y \) 是连续变量，有范围 \( y \in [y_{\min}, y_{\max}] \)。
   - \( z \) 是新的连续变量，表示 \( x \times y \) 的结果。
   
   要将其线性化，可以使用以下线性约束来替代非线性约束：
   
   1. **引入新变量 \( z \)**:
      - 我们引入一个新的变量 \( z \) 来代替 \( x \times y \)。
   
   2. **添加线性不等式约束**:
      - 添加以下线性约束条件：
   
   $$
   \begin{aligned}
       z &\leq y_{\max} \times x, \\
       z &\geq y_{\min} \times x, \\
       z &\leq y - y_{\min} \times (1 - x), \\
       z &\geq y - y_{\max} \times (1 - x).
   \end{aligned}
   $$
   
   
   
   
   ### 解释
   
   - 当 \( x = 0 \) 时：
     - $$
       z \leq y_{\max} \times 0 = 0
       $$
   
     - $$
       z \geq y_{\min} \times 0 = 0
       $$
     
     - 于是 \( z = 0 \)，符合 \( z = x \times y = 0 \) 的要求。
     
   - 当 \( x = 1 \) 时：
     - $$
       z \leq y_{\max} \times 1 = y_{\max} 
       $$
     
     - $$
        z \geq y_{\min} \times 1 = y_{\min} 
       $$
     
     - $$
        z \leq y 
       $$
     
     - $$
       z \geq y
       $$
     
     - 于是 \( z = y \)，符合 \( z = x \times y = y \) 的要求。
   
   通过这些线性不等式，成功地将原来的非线性乘积约束转化为线性约束，从而使问题适合线性规划或混合整数线性规划（MILP）的求解。
   
   ### 示例
   
   假设 \( y_{\min} = 0 \) 和 \( y_{\max} = 100 \)，且我们有以下非线性约束：
   
   \[ z = x \times y \]
   
   它可以被如下的线性约束替代：
   $$
   \begin{aligned}
       z &\leq max(y) \times x, \\
       z &\geq 0, \\
       z &\leq y, \\
       z &\geq y - max(y) \times (1 - x).
       
   \end{aligned}
   $$
   
   
   不等式约束确保了 \( z = x \times y \) 在 \( x \) 和 \( y \) 的所有可能取值下均成立。
   
   ### MATLAB 示例代码
   
   在 MATLAB 中，可以如下定义这些线性约束：
   
   
   
   在这个例子中，线性化后的约束被添加到 `A` 和 `b` 中，以便用 MATLAB 的线性规划工具（如 `intlinprog` 或 `linprog`）进行求解。
   
   ### 
   

#### MATLAB 代码实现

下面是如何在 MATLAB 中用 `intlinprog` 实现这一优化问题。

```matlab

% 定义线性不等式约束
A = [];
b = [];
% 约束1: sum(z(i,j)) < 20 对于每一列 j
for j = 1:numCols
    colIdx = (j-1)*numRows + (1:numRows);  % 第 j 列的索引范围
    A_col = zeros(1, 3*numVars);
    A_col(colIdx + 2*numVars) = 1;  % 取出第 j 列 z 的元素
    A = [A; A_col];
    b = [b; 20];
end
% 约束2: z(i,j) <= y(i,j)
A2 = [zeros(numVars), -eye(numVars), eye(numVars)];
b2 = zeros(numVars, 1);

% 约束3: z(i,j) <= 20 * x(i,j)
A3 = [zeros(numVars), eye(numVars), -20 * eye(numVars)];
b3 = zeros(numVars, 1);

% 约束4: z(i,j) >= y(i,j) - 20 * (1 - x(i,j))
A4 = [zeros(numVars), eye(numVars), -eye(numVars)];
b4 = zeros(numVars, 1);

% 汇总所有约束
A = [A; A2; A3; A4];
b = [b; b2; b3; b4];

```

### 代码解释

+ **辅助变量**: `z(i,j)` 用于表示 \( x(i,j) \times y(i,j) \) 的乘积，通过增加线性不等式约束来保证其值正确。

